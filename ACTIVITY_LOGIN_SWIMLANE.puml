@startuml Activity_Login_Swimlane
skinparam backgroundColor #FEFEFE
skinparam swimlane {
  BorderColor #8B4513
  TitleFontSize 12
}
skinparam activity {
  BackgroundColor #FFF8DC
  BorderColor #8B4513
  FontSize 10
}

title **Activity Diagram dengan Swimlane - Proses Login**\n**Sistem Informasi Akuntansi UMKM**

|#LightBlue|Pengguna|
start
:Membuka browser;
:Akses URL website;
note right
  localhost:8000
  atau domain production
end note

|#LightGreen|Sistem|
:Tampilkan halaman login;
note right
  Route: /login
  View: auth/login.blade.php
end note

|#LightBlue|Pengguna|
:Lihat form login;
:Isi email;
:Isi password;
:Centang "Remember Me" (opsional);
:Klik tombol "Login";

|#LightGreen|Sistem|
:Terima request POST;
note right
  Route: POST /login
  Controller: LoginController
end note

:Validasi CSRF token;

if (CSRF valid?) then (tidak)
  :Return error 419;
  |#LightBlue|Pengguna|
  :Lihat error "Page expired";
  stop
else (ya)
  |#LightGreen|Sistem|
  :Validasi input form;
  note right
    • Email: required|email
    • Password: required|string
  end note
  
  if (Input valid?) then (tidak)
    :Kirim error validasi;
    |#LightBlue|Pengguna|
    :Lihat pesan error;
    note right
      • "Email harus diisi"
      • "Format email salah"
      • "Password harus diisi"
    end note
    backward :Perbaiki input;
  else (ya)
    |#LightGreen|Sistem|
    :Query database users;
    note right
      SELECT * FROM users
      WHERE email = ?
    end note
    
    if (User ditemukan?) then (tidak)
      :Return error login;
      |#LightBlue|Pengguna|
      :Lihat "Email atau password salah";
      backward :Coba login lagi;
    else (ya)
      |#LightGreen|Sistem|
      :Verify password hash;
      note right
        Hash::check($password, $user->password)
      end note
      
      if (Password cocok?) then (tidak)
        :Return error login;
        |#LightBlue|Pengguna|
        :Lihat "Email atau password salah";
        backward :Coba login lagi;
      else (ya)
        |#LightGreen|Sistem|
        :Buat session baru;
        note right
          • Set session user_id
          • Set auth guard
          • Regenerate session ID
        end note
        
        if (Remember Me checked?) then (ya)
          :Buat remember token;
          note right
            Token valid 2 minggu
          end note
        endif
        
        :Update last_login timestamp;
        :Redirect ke /dashboard;
        
        |#LightBlue|Pengguna|
        :Masuk ke dashboard;
        note right
          **Akses menu:**
          • Dashboard
          • Master Data
          • Transaksi
          • Laporan
          • Akuntansi
        end note
        
        stop
      endif
    endif
  endif
endif

@enduml
