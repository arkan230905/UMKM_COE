<!DOCTYPE html>
<html>
<head>
    <title>Test Enhanced Conversion System</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .error { background: #ffebee; color: #c62828; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Test Enhanced Conversion System</h1>
    
    <div class="test">
        <h3>Test Conversions:</h3>
        <button onclick="testConversion('Kilogram', 'Gram', 32000)">Kilogram → Gram (Rp 32,000)</button>
        <button onclick="testConversion('Ekor', 'Potong', 45000)">Ekor → Potong (Rp 45,000)</button>
        <button onclick="testConversion('Liter', 'Mililiter', 14000)">Liter → Mililiter (Rp 14,000)</button>
        <button onclick="testConversion('Ons', 'Gram', 25000)">Ons → Gram (Rp 25,000)</button>
        <button onclick="testConversion('Pieces', 'Buah', 2000)">Pieces → Buah (Rp 2,000)</button>
    </div>
    
    <div class="test">
        <h3>Test Results:</h3>
        <div id="testResults"></div>
    </div>

    <script>
        // Enhanced conversion system with comprehensive unit support
        function getConversionFactor(fromUnit, toUnit) {
            const from = fromUnit.toLowerCase().trim();
            const to = toUnit.toLowerCase().trim();
            
            // Conversion table - all conversions to base unit first, then to target
            const conversions = {
                // Weight conversions (base: gram)
                'kilogram': { toGram: 1000, name: 'Kilogram' },
                'kg': { toGram: 1000, name: 'Kilogram' },
                'gram': { toGram: 1, name: 'Gram' },
                'gr': { toGram: 1, name: 'Gram' },
                'ons': { toGram: 100, name: 'Ons' },
                'miligram': { toGram: 0.001, name: 'Miligram' },
                'mg': { toGram: 0.001, name: 'Miligram' },
                
                // Volume conversions (base: mililiter)
                'liter': { toMl: 1000, name: 'Liter' },
                'l': { toMl: 1000, name: 'Liter' },
                'mililiter': { toMl: 1, name: 'Mililiter' },
                'ml': { toMl: 1, name: 'Mililiter' },
                'sendok teh': { toMl: 5, name: 'Sendok Teh' },
                'sendok makan': { toMl: 15, name: 'Sendok Makan' },
                
                // Count conversions (base: pieces)
                'pieces': { toPcs: 1, name: 'Pieces' },
                'pcs': { toPcs: 1, name: 'Pieces' },
                'buah': { toPcs: 1, name: 'Buah' },
                'butir': { toPcs: 1, name: 'Butir' },
                'biji': { toPcs: 1, name: 'Biji' },
                'bungkus': { toPcs: 1, name: 'Bungkus' },
                'siung': { toPcs: 1, name: 'Siung' },
                
                // Special conversions
                'ekor': { toPcs: 1, name: 'Ekor', special: true },
                'potong': { toPcs: 1, name: 'Potong', special: true }
            };
            
            const fromConv = conversions[from];
            const toConv = conversions[to];
            
            if (!fromConv || !toConv) {
                return { factor: null, formula: '', operation: '', value: '' };
            }
            
            // Special case: Ekor to Potong (1 ekor = 6 potong)
            if (from === 'ekor' && to === 'potong') {
                return {
                    factor: 1/6,
                    formula: 'Rumus: 1 Ekor = 6 Potong',
                    operation: '÷',
                    value: '6'
                };
            }
            
            // Special case: Potong to Ekor (6 potong = 1 ekor)
            if (from === 'potong' && to === 'ekor') {
                return {
                    factor: 6,
                    formula: 'Rumus: 6 Potong = 1 Ekor',
                    operation: '×',
                    value: '6'
                };
            }
            
            // Weight conversions
            if (fromConv.toGram && toConv.toGram) {
                const factor = fromConv.toGram / toConv.toGram;
                
                if (factor > 1) {
                    return {
                        factor: 1/factor,
                        formula: `Rumus: 1 ${fromConv.name} = ${Math.round(factor)} ${toConv.name}`,
                        operation: '÷',
                        value: Math.round(factor).toString()
                    };
                } else {
                    const multiplier = 1/factor;
                    return {
                        factor: factor,
                        formula: `Rumus: ${Math.round(multiplier)} ${fromConv.name} = 1 ${toConv.name}`,
                        operation: '×',
                        value: factor.toString()
                    };
                }
            }
            
            // Volume conversions
            if (fromConv.toMl && toConv.toMl) {
                const factor = fromConv.toMl / toConv.toMl;
                
                if (factor > 1) {
                    return {
                        factor: 1/factor,
                        formula: `Rumus: 1 ${fromConv.name} = ${Math.round(factor)} ${toConv.name}`,
                        operation: '÷',
                        value: Math.round(factor).toString()
                    };
                } else {
                    const multiplier = 1/factor;
                    return {
                        factor: factor,
                        formula: `Rumus: ${Math.round(multiplier)} ${fromConv.name} = 1 ${toConv.name}`,
                        operation: '×',
                        value: factor.toString()
                    };
                }
            }
            
            // Count conversions (same category)
            if (fromConv.toPcs && toConv.toPcs && !fromConv.special && !toConv.special) {
                return {
                    factor: 1,
                    formula: `Rumus: 1 ${fromConv.name} = 1 ${toConv.name}`,
                    operation: '×',
                    value: '1'
                };
            }
            
            return { factor: null, formula: '', operation: '', value: '' };
        }
        
        function testConversion(fromUnit, toUnit, price) {
            const result = getConversionFactor(fromUnit, toUnit);
            const testResults = document.getElementById('testResults');
            
            if (result.factor !== null) {
                const convertedPrice = price * result.factor;
                testResults.innerHTML += `
                    <div class="success">
                        <strong>${fromUnit} → ${toUnit}</strong><br>
                        ${result.formula}<br>
                        Rp ${price.toLocaleString('id-ID')} ${result.operation} ${result.value} = Rp ${Math.round(convertedPrice).toLocaleString('id-ID')}/${toUnit}
                    </div>
                `;
            } else {
                testResults.innerHTML += `
                    <div class="error">
                        <strong>${fromUnit} → ${toUnit}</strong><br>
                        Konversi tidak tersedia
                    </div>
                `;
            }
        }
    </script>
</body>
</html>